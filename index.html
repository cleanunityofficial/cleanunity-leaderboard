<script>
  const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vS1vf0Zo33RdqSf3pHc-6vdPyFTkg5Cg-wNCkhtIvXLL6LSrRBbBd5hdyszdLPpMBCSUWBFxpd4HzzT/pub?gid=229848225&single=true&output=csv";

  async function fetchData() {
    try {
      const res = await fetch(CSV_URL);
      const data = await res.text();
      const rows = data.trim().split("\n").slice(1); // skip header
      const tbody = document.getElementById("leaderboard-body");
      tbody.innerHTML = "";

      rows.forEach(row => {
        // Split the CSV row into columns
        // A = Name, B = Points, C = Rank
        const cols = row.split(",");
        const name = cols[0].trim();
        const points = parseInt(cols[1].trim()) || 0;
        const rank = parseInt(cols[2].trim()) || 0;

        const tr = document.createElement("tr");

        // Rank column
        const rankTd = document.createElement("td");
        rankTd.dataset.label = "Rank";
        if (rank === 1) rankTd.innerHTML = '<span class="medal">ðŸ¥‡</span>';
        else if (rank === 2) rankTd.innerHTML = '<span class="medal">ðŸ¥ˆ</span>';
        else if (rank === 3) rankTd.innerHTML = '<span class="medal">ðŸ¥‰</span>';
        else rankTd.textContent = rank;

        // Name column
        const nameTd = document.createElement("td");
        nameTd.dataset.label = "Full Name";
        nameTd.textContent = name;

        // Points column
        const pointsTd = document.createElement("td");
        pointsTd.dataset.label = "Points";
        pointsTd.textContent = points;

        tr.appendChild(rankTd);
        tr.appendChild(nameTd);
        tr.appendChild(pointsTd);
        tbody.appendChild(tr);
      });
    } catch (err) {
      console.error("Error fetching leaderboard:", err);
    }
  }

  // Initial fetch
  fetchData();

  // Refresh every 1 minute
  setInterval(fetchData, 60 * 1000);

  // Manual refresh
  document.getElementById("refresh-btn").addEventListener("click", fetchData);

  // Search functionality
  document.getElementById("search").addEventListener("input", function () {
    const searchValue = this.value.toLowerCase();
    const rows = document.querySelectorAll("#leaderboard tbody tr");
    rows.forEach(row => {
      const name = row.querySelector("td:nth-child(2)").textContent.toLowerCase();
      row.style.display = name.includes(searchValue) ? "" : "none";
    });
  });
</script>

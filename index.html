const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vS1vf0Zo33RdqSf3pHc-6vdPyFTkg5Cg-wNCkhtIvXLL6LSrRBbBd5hdyszdLPpMBCSUWBFxpd4HzzT/pub?gid=229848225&single=true&output=csv";

async function fetchData() {
  const res = await fetch(CSV_URL);
  const data = await res.text();
  const rows = data.trim().split('\n').slice(1);
  const tbody = document.getElementById("leaderboard-body");
  tbody.innerHTML = "";

  rows.forEach(row => {
    // Split into exactly 3 columns: name, points, rank
    const cols = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/); // Handles commas inside quotes
    const [name, points, rank] = cols.map(c => c.replace(/"/g, '').trim());

    const tr = document.createElement("tr");

    const rankTd = document.createElement("td");
    rankTd.dataset.label = "Rank";
    if (parseInt(rank) === 1) rankTd.innerHTML = '<span class="medal">ðŸ¥‡</span>';
    else if (parseInt(rank) === 2) rankTd.innerHTML = '<span class="medal">ðŸ¥ˆ</span>';
    else if (parseInt(rank) === 3) rankTd.innerHTML = '<span class="medal">ðŸ¥‰</span>';
    else rankTd.textContent = rank;

    const nameTd = document.createElement("td");
    nameTd.dataset.label = "Full Name";
    nameTd.textContent = name;

    const pointsTd = document.createElement("td");
    pointsTd.dataset.label = "Points";
    pointsTd.textContent = points;

    tr.appendChild(rankTd);
    tr.appendChild(nameTd);
    tr.appendChild(pointsTd);
    tbody.appendChild(tr);
  });
}

<script>
  // Replace this with your published Google Sheet web page link
  const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vS1vf0Zo33RdqSf3pHc-6vdPyFTkg5Cg-wNCkhtIvXLL6LSrRBbBd5hdyszdLPpMBCSUWBFxpd4HzzT/htmlview?gid=229848225";

  async function fetchData() {
    const tbody = document.getElementById("leaderboard-body");
    tbody.innerHTML = "<tr><td colspan='3'>Loading...</td></tr>";

    try {
      const res = await fetch(SHEET_URL);
      const text = await res.text();

      // Extract table rows from the HTML page
      const parser = new DOMParser();
      const doc = parser.parseFromString(text, "text/html");
      const rows = Array.from(doc.querySelectorAll("table tbody tr"));

      // Map rows into objects
      const data = rows.map(r => {
        const cols = r.querySelectorAll("td");
        return {
          rank: cols[2]?.textContent.trim(),       // rank column
          name: cols[0]?.textContent.trim(),       // full name column
          points: cols[1]?.textContent.trim()      // points column
        };
      });

      // Clear and insert into leaderboard
      tbody.innerHTML = "";
      data.forEach((entry, idx) => {
        const tr = document.createElement("tr");

        const rankTd = document.createElement("td");
        rankTd.dataset.label = "Rank";
        if (idx === 0) rankTd.innerHTML = "ðŸ¥‡";
        else if (idx === 1) rankTd.innerHTML = "ðŸ¥ˆ";
        else if (idx === 2) rankTd.innerHTML = "ðŸ¥‰";
        else rankTd.textContent = entry.rank || idx + 1;

        const nameTd = document.createElement("td");
        nameTd.dataset.label = "Full Name";
        nameTd.textContent = entry.name;

        const pointsTd = document.createElement("td");
        pointsTd.dataset.label = "Points";
        pointsTd.textContent = entry.points;

        tr.appendChild(rankTd);
        tr.appendChild(nameTd);
        tr.appendChild(pointsTd);
        tbody.appendChild(tr);
      });

    } catch (err) {
      tbody.innerHTML = "<tr><td colspan='3'>Error fetching data. Try again.</td></tr>";
      console.error(err);
    }
  }

  fetchData();
  setInterval(fetchData, 2 * 60 * 1000); // Refresh every 2 mins
  document.getElementById("refresh-btn").addEventListener("click", fetchData);
  document.getElementById("search").addEventListener("input", function () {
    const searchValue = this.value.toLowerCase();
    document.querySelectorAll("#leaderboard tbody tr").forEach(row => {
      const name = row.querySelector("td:nth-child(2)").textContent.toLowerCase();
      row.style.display = name.includes(searchValue) ? "" : "none";
    });
  });
</script>


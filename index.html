<script>
  const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vS1vf0Zo33RdqSf3pHc-6vdPyFTkg5Cg-wNCkhtIvXLL6LSrRBbBd5hdyszdLPpMBCSUWBFxpd4HzzT/pub?gid=229848225&single=true&output=csv";

  async function fetchData() {
    try {
      const res = await fetch(CSV_URL);
      const data = await res.text();
      const rows = data.trim().split("\n").slice(1); // skip header
      const tbody = document.getElementById("leaderboard-body");
      tbody.innerHTML = "";

      const fragment = document.createDocumentFragment();

      rows.forEach((row, idx) => {
        const cols = row.split(",");
        const name = cols[0].trim();
        const points = parseInt(cols[1]) || 0;
        const rank = cols[2] ? cols[2].trim() : (idx + 1);

        const tr = document.createElement("tr");

        const rankTd = document.createElement("td");
        rankTd.dataset.label = "Rank";
        if (idx === 0) rankTd.innerHTML = "ðŸ¥‡";
        else if (idx === 1) rankTd.innerHTML = "ðŸ¥ˆ";
        else if (idx === 2) rankTd.innerHTML = "ðŸ¥‰";
        else rankTd.textContent = rank;

        const nameTd = document.createElement("td");
        nameTd.dataset.label = "Full Name";
        nameTd.textContent = name;

        const pointsTd = document.createElement("td");
        pointsTd.dataset.label = "Points";
        pointsTd.textContent = points;

        tr.appendChild(rankTd);
        tr.appendChild(nameTd);
        tr.appendChild(pointsTd);
        fragment.appendChild(tr);
      });

      tbody.appendChild(fragment);
    } catch (err) {
      console.error("Error loading leaderboard:", err);
    }
  }

  // Initial fetch
  fetchData();

  // Refresh every 1 minute
  setInterval(fetchData, 60 * 1000);

  // Manual refresh
  document.getElementById("refresh-btn").addEventListener("click", fetchData);

  // Search functionality
  document.getElementById("search").addEventListener("input", function () {
    const searchValue = this.value.toLowerCase();
    document.querySelectorAll("#leaderboard tbody tr").forEach(row => {
      const name = row.querySelector("td:nth-child(2)").textContent.toLowerCase();
      row.style.display = name.includes(searchValue) ? "" : "none";
    });
  });
</script>

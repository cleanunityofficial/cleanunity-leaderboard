<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CleanUnity Leaderboard üèÜ</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet"/>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: "Poppins", sans-serif; }
    body {
      background: linear-gradient(135deg, #1a1a40, #4a90e2);
      min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 40px 20px;
      animation: fadeIn 1.5s ease-in-out;
    }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .container {
      background: rgba(255,255,255,0.1); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
      padding: 30px; border-radius: 20px; max-width: 1000px; width: 100%; color: #fff; box-shadow: 0 8px 32px rgba(0,0,0,0.37);
      overflow-x: auto;
    }
    h1 { text-align: center; margin-bottom: 30px; font-size: 2rem; display: flex; justify-content: center; align-items: center; gap: 10px; }
    #refresh-btn { background: none; border: none; color: #fff; cursor: pointer; font-size: 1.5rem; padding: 0; line-height: 1; transition: transform 0.2s ease; }
    #refresh-btn:hover { transform: rotate(30deg); }
    .search-bar { text-align: center; margin-bottom: 20px; }
    .search-bar input { padding: 10px; width: 100%; max-width: 400px; border: none; border-radius: 5px; font-size: 1rem; }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.2); }
    th { background-color: rgba(255,255,255,0.1); }
    tr { transition: box-shadow 0.3s, background-color 0.3s; }
    tr:hover { background-color: rgba(255,255,255,0.1); box-shadow: 0 0 10px #00ffff; }
    .medal { font-size: 1.5rem; }
    @media (max-width: 768px) {
      table, thead, tbody, th, td, tr { display: block; }
      thead tr { display: none; }
      tbody tr { margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.1); border-radius: 10px; padding: 10px; }
      td { padding: 10px; text-align: right; position: relative; }
      td::before { content: attr(data-label); position: absolute; left: 10px; width: 50%; padding-right: 10px; white-space: nowrap; text-align: left; font-weight: bold; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>
      CleanUnity Leaderboard üèÜ
      <button id="refresh-btn" title="Refresh leaderboard">üîÑ</button>
    </h1>
    <div class="search-bar">
      <input type="text" id="search" placeholder="Search by name..." />
    </div>
    <table id="leaderboard">
      <thead>
        <tr>
          <th>Rank</th>
          <th>Full Name</th>
          <th>Points</th>
        </tr>
      </thead>
      <tbody id="leaderboard-body"></tbody>
    </table>
  </div>

  <script>
    const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vS1vf0Zo33RdqSf3pHc-6vdPyFTkg5Cg-wNCkhtIvXLL6LSrRBbBd5hdyszdLPpMBCSUWBFxpd4HzzT/pubhtml?gid=229848225&single=true";

    function parseCSV(text) {
      const lines = text.trim().split("\n").slice(1);
      return lines.map(line => {
        const regex = /(".*?"|[^",\s]+)(?=\s*,|\s*$)/g;
        const matches = [];
        let match;
        while ((match = regex.exec(line)) !== null) {
          matches.push(match[1].replace(/^"|"$/g, ""));
        }
        return matches;
      });
    }

    async function fetchData() {
      try {
        const res = await fetch(CSV_URL);
        const data = await res.text();
        const rows = parseCSV(data);
        const tbody = document.getElementById("leaderboard-body");
        tbody.innerHTML = "";
        const fragment = document.createDocumentFragment();

        rows.forEach((cols, idx) => {
          const name = cols[0] || "N/A";
          const points = parseInt(cols[1]) || 0;
          const rank = cols[2] || (idx + 1);

          const tr = document.createElement("tr");
          const rankTd = document.createElement("td");
          rankTd.dataset.label = "Rank";
          rankTd.innerHTML = idx === 0 ? "ü•á" : idx === 1 ? "ü•à" : idx === 2 ? "ü•â" : rank;

          const nameTd = document.createElement("td");
          nameTd.dataset.label = "Full Name";
          nameTd.textContent = name;

          const pointsTd = document.createElement("td");
          pointsTd.dataset.label = "Points";
          pointsTd.textContent = points;

          tr.appendChild(rankTd);
          tr.appendChild(nameTd);
          tr.appendChild(pointsTd);
          fragment.appendChild(tr);
        });

        tbody.appendChild(fragment);
      } catch (err) {
        console.error("Error loading leaderboard:", err);
      }
    }

    fetchData();
    setInterval(fetchData, 60 * 1000);
    document.getElementById("refresh-btn").addEventListener("click", fetchData);
    document.getElementById("search").addEventListener("input", function () {
      const searchValue = this.value.toLowerCase();
      document.querySelectorAll("#leaderboard tbody tr").forEach(row => {
        const name = row.querySelector("td:nth-child(2)").textContent.toLowerCase();
        row.style.display = name.includes(searchValue) ? "" : "none";
      });
    });
  </script>
</body>
</html>



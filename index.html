<script>
  const DATA_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vS1vf0Zo33RdqSf3pHc-6vdPyFTkg5Cg-wNCkhtIvXLL6LSrRBbBd5hdyszdLPpMBCSUWBFxpd4HzzT/pubhtml?gid=229848225&single=true";

  async function fetchData() {
    try {
      const res = await fetch(DATA_URL);
      const data = await res.text();
      const rows = data.trim().split('\n').slice(1); // skip header row
      const tbody = document.getElementById("leaderboard-body");
      tbody.innerHTML = "";

      rows
        .map(row => {
          const [name, points, rank] = row.split(","); // adjust order if needed
          return { rank: parseInt(rank) || 0, name: name.trim(), points: parseInt(points) || 0 };
        })
        .sort((a, b) => a.rank - b.rank) // sort by rank ascending
        .forEach(entry => {
          const tr = document.createElement("tr");

          const rankTd = document.createElement("td");
          rankTd.dataset.label = "Rank";
          if (entry.rank === 1) rankTd.innerHTML = '<span class="medal">ðŸ¥‡</span>';
          else if (entry.rank === 2) rankTd.innerHTML = '<span class="medal">ðŸ¥ˆ</span>';
          else if (entry.rank === 3) rankTd.innerHTML = '<span class="medal">ðŸ¥‰</span>';
          else rankTd.textContent = entry.rank;

          const nameTd = document.createElement("td");
          nameTd.dataset.label = "Full Name";
          nameTd.textContent = entry.name;

          const pointsTd = document.createElement("td");
          pointsTd.dataset.label = "Points";
          pointsTd.textContent = entry.points;

          tr.appendChild(rankTd);
          tr.appendChild(nameTd);
          tr.appendChild(pointsTd);
          tbody.appendChild(tr);
        });
    } catch (error) {
      console.error("Error fetching data:", error);
      const tbody = document.getElementById("leaderboard-body");
      tbody.innerHTML = '<tr><td colspan="3">Error fetching data. Please try again.</td></tr>';
    }
  }

  // Initial fetch
  fetchData();

  // Refresh every 2 minutes
  setInterval(fetchData, 2 * 60 * 1000);

  // Manual refresh
  document.getElementById("refresh-btn").addEventListener("click", fetchData);

  // Search functionality
  document.getElementById("search").addEventListener("input", function () {
    const searchValue = this.value.toLowerCase();
    const rows = document.querySelectorAll("#leaderboard tbody tr");
    rows.forEach(row => {
      const name = row.querySelector("td:nth-child(2)").textContent.toLowerCase();
      row.style.display = name.includes(searchValue) ? "" : "none";
    });
  });
</script>
